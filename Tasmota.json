{ "name":"Tasmota",
   "manufacturer":"Ton",
   "type":"LIGHT",
   "version":5,
   "discover":{
     "welcomeheadertext":"Choose your Tasmota Instance with new Protocol (SetOption19 0",
     "welcomedescription":"powered by meta\nby TonO",
   "command":
         {"type":"mqtt","command":"{\"waitTime\":2000,\"connection\":\"mqtt://192.168.73.24\",\"topic\":\"tasmota/discovery/+/config\",\"function\":\"getonly\",\"message\":\"\"}",
            "queryresult":["$.*.message"]
         }         
   },
   "template" : 
   {
    "name":"Tasmota",
   "manufacturer":"Ton",
   "type":"LIGHT",
   "version":5,
   "dynamicname":  "DYNAMIK_INST_START DYNAMIK JSON.parse(\"$Result\").t  DYNAMIK_INST_END",
   "dynamicid":   "DYNAMIK_INST_START DYNAMIK JSON.parse(\"$Result\").ip  DYNAMIK_INST_END",
   "listeners" : {
      "STAT" : 
      {"label":"",
        "type":"mqtt",
        "command":"{\"connection\": \"$MQTT_IP\",\"topic\":\"$Topic/Power\",\"message\":\"\",\"replytopic\":\"stat/$Tasmota_ID/POWER\"}",   
        "queryresult":"",
        "evalwrite" : [ 
           {"variable" : "PowerStatus",     "value" :  "DYNAMIK JSON.stringify(JSON.parse(\"$Result\").message)"}
        ]
      }
   },
   "variables":{
      "MQTT_IP":"mqtt://192.168.73.24",
      "MYRESULT": "",
      "Topic": "DYNAMIK_INST_START DYNAMIK \"cmnd/\"+JSON.parse(\"$Result\").t  DYNAMIK_INST_END",
      "Message": "",
      "Tasmota_ID": "DYNAMIK_INST_START DYNAMIK JSON.parse(\"$Result\").t  DYNAMIK_INST_END",
      "Tasmota_IP": "DYNAMIK_INST_START DYNAMIK JSON.parse(\"$Result\").ip  DYNAMIK_INST_END", 
      "DimValue":0,
      "PowerStatus":"",
      "Hostname":""
   },
   "labels": {
      "Topic": {"label": "Topic","listen": "Topic"}, 
      "PowerStatus": {"label": "PowerStatus","listen": "PowerStatus"}, 
      "Hostname": {"label": "Hostname","listen": "Hostname"}, 
      "Tasmota_IP": {"label": "Tasmota_IP","listen": "Tasmota_IP"}, 
      "MQTT_IP": {"label": "Connected MQTT","listen": "MQTT_IP"}, 
      "MYRESULT": {"label": "MYRESULT","listen": "MYRESULT"} 
   },   
   "sliders":{
      "Dimmer":  
      {"label":"Dimmmer", "unit" : "pct", "listen" : "DimValue", 
      "evaldo":[{"test":true,"then":"__SetDimvalue","or":""}]}
   },
   "buttons":{
      "__INITIALISE": {"label": "", "type":"static", "command":"{}"},
      "__CHECK":  {"label":"",
         "type":"static", "command":"{}"
      },

         "POWER ON":  
         {"label":"",      
            "type":"static",
            "command":"{}", 
            "evaldo":[{"test":true,"then":"__INITIALISE","or":""}]
         },
         "POWER OFF":  
         {"label":"",    
            "type":"static",
            "command":"{}",
            "evaldo":[{"test":true,"then":"__CLEANUP","or":""}]
         },
         "LIGHT ON":  
         {"label":"",      
            "type":"mqtt",
            "command":"{\"connection\": \"$MQTT_IP\",\"topic\":\"$Topic/Power\",\"message\":\"ON\"}" 
         },
         "LIGHT OFF":  
         {"label":"",    
            "type":"mqtt",
            "command":"{\"connection\": \"$MQTT_IP\",\"topic\":\"$Topic/Power\",\"message\":\"OFF\"}"
         },
         "Dimmer Up":  
         {"label":"",    
            "type":"mqtt",
            "command":"{\"connection\": \"$MQTT_IP\",\"topic\":\"$Tasmota_ID/Dimmer\",\"message\":\"+\"}", 
            "evaldo":{"test":true,"then":""}
         },
         "Dimmer Down":  
         {"label":"",    
            "type":"mqtt",
            "command":"{\"connection\": \"$MQTT_IP\",\"topic\":\"$Tasmota_ID/Dimmer\",\"message\":\"-\"}"
         },
         "__SetDimvalue":  
         {"label":"",    
            "type":"mqtt",
            "command":"{\"connection\": \"//$MQTT_IP\",\"topic\":\"$Tasmota_ID/Dimmer\",\"message\":\"$DimValue\"}"
         }
      }   
   }
}


 

